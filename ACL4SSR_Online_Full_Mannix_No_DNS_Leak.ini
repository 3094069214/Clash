# 针对中国大陆移动手机蜂窝数据网络优化的Meta内核配置文件
[custom]

# 基础设置
exclude_remarks=(Data Left|Remain:|Traffic:|Expir[ey]|Reset|(\d[\d.]*\s*[MG]B[^\dA-Za-z]+|[:：]\s*)\d[\d.]*\s*GB(?![\dA-Za-z])|剩[余餘]流量|流量：|[到过過效]期|[时時][间間]|重置|分割线|残り使用容量|有効期限|リセット|🔰 (ID|HSD|SNI):|📝 Gói:)

# Emoji 设置
add_emoji=true
remove_old_emoji=true
emoji=(?!🇨🇳)[🇦-🇿]{2},
emoji=^(?!.*[🇦-🇿]{2}).*(美国|华盛顿|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|旧金山|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|纽约|丹佛|加利福尼亚|弗吉尼亚|得克萨斯|亚特兰大|佛罗里达|迈阿密|US|USA|United States|Washington|Portland|Dallas|Oregon|Phoenix|Fremont|Silicon Valley|San Francisco|Las Vegas|Los Angeles|San Jose|Santa Clara|Seattle|Chicago|New York|Denver|California|Virginia|Texas|Atlanta|Florida|Miami),🇺🇸
emoji=^(?!.*[🇦-🇿]{2}).*(香港|HK|Hong Kong),🇭🇰
emoji=^(?!.*[🇦-🇿]{2}).*(日本|东京|大阪|名古屋|埼玉|福冈|JP|Japan|Tokyo|Osaka|Nagoya|Saitama|Fukuoka),🇯🇵
emoji=^(?!.*[🇦-🇿]{2}).*(新加坡|狮城|SG|Singapore),🇸🇬
emoji=^(?!.*[🇦-🇿]{2}).*(台湾|台北|新北|彰化|高雄|TW|Taiwan|Taipei|New Taipei|Changhua|Kaohsiung),🇹🇼
emoji=^(?!.*[🇦-🇿]{2}).*(英国|英格兰|伦敦|曼彻斯特|UK|United Kingdom|England|London|Manchester),🇬🇧
emoji=^(?!.*[🇦-🇿]{2}).*(加拿大|多伦多|蒙特利尔|温哥华|CA|Canada|Toronto|Montreal|Vancouver),🇨🇦
emoji=^(?!.*[🇦-🇿]{2}).*(德国|法兰克福|柏林|DE|Germany|Frankfurt|Berlin),🇩🇪
emoji=^(?!.*[🇦-🇿]{2}).*(法国|巴黎|FR|France|Paris),🇫🇷
emoji=^(?!.*[🇦-🇿]{2}).*(韩国|首尔|KR|Korea|South Korea|Seoul),🇰🇷
emoji=^(?!.*[🇦-🇿]{2}).*(澳大利亚|悉尼|墨尔本|AU|Australia|Sydney|Melbourne),🇦🇺
emoji=^(?!.*[🇦-🇿]{2}).*(俄罗斯|莫斯科|圣彼得堡|RU|Russia|Moscow|Saint Petersburg),🇷🇺
emoji=^(?!.*([🇦-🇿]{2}|ℹ️)).*(官.?网|官方|产品|平台|勿连|修复|恢复|更新|地址|网站|网址|域名|网域|浏览器|导航|搜|群|裙|聊|频道|电报|飞机|扣|微信|售后|客服|工单|联系|使用|购买|续费|订阅|公告|版本|出现|没网|情况|开通|数量|注|说明|通知|去除|过滤|@|：|(?i:(?<![\da-z])(tg|telegram|t\.me|qq?|vx?|wx)(?!\d*[a-z]|\d{1,3}(?!\d))|^[^:]+:(?![\da-f]{0,4}:|\s*\d{1,5}([/?]|\s*$)))),ℹ️

enable_rule_generator=true
overwrite_original_rules=true

# 代理分组 - Meta内核支持的格式
custom_proxy_group=🚀代理`select`[]⚡低延迟`[]🇭🇰香港`[]🇸🇬新加坡`[]🇯🇵日本`[]🇺🇸美国`[]🇹🇼台湾`[]🌍其他`[]👆🏻指定`[]DIRECT`[]REJECT
custom_proxy_group=👆🏻指定`select`.*
custom_proxy_group=⚡低延迟`url-test`.*`https://cp.cloudflare.com/generate_204`900,,180
custom_proxy_group=🇭🇰香港`url-test`(?i)(?=.*(港|HK|Hong))(?!.*(回国|校园|游戏|GAME)).*`https://cp.cloudflare.com/generate_204`900,,180
custom_proxy_group=🇸🇬新加坡`url-test`(?i)(?=.*(新|狮|獅|SG|Singapore))(?!.*(回国|校园|游戏|GAME)).*`https://cp.cloudflare.com/generate_204`900,,180
custom_proxy_group=🇯🇵日本`url-test`(?i)(?=.*(日|JP|Japan))(?!.*(回国|校园|游戏|GAME)).*`https://cp.cloudflare.com/generate_204`900,,180
custom_proxy_group=🇺🇸美国`url-test`(?i)(?=.*(美|US|United States))(?!.*(回国|校园|游戏|GAME)).*`https://cp.cloudflare.com/generate_204`900,,180
custom_proxy_group=🇹🇼台湾`url-test`(?i)(?=.*(台|TW|Taiwan))(?!.*(回国|校园|游戏|GAME)).*`https://cp.cloudflare.com/generate_204`900,,180
custom_proxy_group=🌍其他`select`^(?!.*(港|HK|Hong|台|TW|Taiwan|日|JP|Japan|新|狮|獅|SG|Singapore|美|US|United States|回国|校园|游戏|GAME)).*$

# 应用分组
custom_proxy_group=🌐国际`select`[]🚀代理`[]🇺🇸美国`[]🇸🇬新加坡`[]🇭🇰香港`[]🇯🇵日本`[]🇹🇼台湾`[]🌍其他
custom_proxy_group=📱社交聊天`select`[]DIRECT`[]🚀代理`[]🇭🇰香港`[]🇸🇬新加坡`[]🇺🇸美国
custom_proxy_group=🎬流媒体`select`[]🚀代理`[]🇭🇰香港`[]🇸🇬新加坡`[]🇹🇼台湾`[]🇯🇵日本`[]🇺🇸美国`[]🌍其他
custom_proxy_group=🇨🇳直连`select`[]DIRECT`[]🚀代理
custom_proxy_group=📱短视频`select`[]DIRECT`[]🚀代理
custom_proxy_group=🎮游戏直播`select`[]DIRECT`[]🚀代理
custom_proxy_group=🛒购物平台`select`[]DIRECT`[]🚀代理
custom_proxy_group=📢广告隐私`select`[]REJECT`[]DIRECT`[]🚀代理
custom_proxy_group=🐠漏网之鱼`select`[]🚀代理`[]DIRECT`[]👆🏻指定

# 分流规则
ruleset=DIRECT,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/LocalAreaNetwork.list
# 重要的国内服务优先匹配
ruleset=🇨🇳直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/UnionPay.list
ruleset=🇨🇳直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/AliPay.list
ruleset=📱社交聊天,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/WeChat.list
ruleset=📱社交聊天,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Tencent.list
# 短视频和购物高频应用提前匹配
ruleset=📱短视频,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/DouYin.list
ruleset=🛒购物平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/JingDong.list
ruleset=🛒购物平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Taobao.list
ruleset=🛒购物平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/PDD.list
# 广告过滤
ruleset=📢广告隐私,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyListChina.list
ruleset=📢广告隐私,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyPrivacy.list
# 游戏直播
ruleset=🎮游戏直播,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Douyu.list
ruleset=🎮游戏直播,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/HuYa.list
ruleset=🎮游戏直播,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/BiliBili/BiliBili.yaml
# 国内服务
ruleset=🇨🇳直连,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Alibaba/Alibaba_Classical.yaml
ruleset=🇨🇳直连,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ByteDance/ByteDance_Classical.yaml
ruleset=🇨🇳直连,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Baidu/Baidu_Classical.yaml
ruleset=🇨🇳直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaMedia.list
# 国际服务
ruleset=🌐国际,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Google.list
ruleset=🌐国际,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Telegram.list
ruleset=🌐国际,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Twitter.list
ruleset=🎬流媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/YouTube.list
ruleset=🎬流媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyMedia.list
# 基础分流规则
ruleset=🚀代理,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyGFWlist.list
# 直连规则放到最后
ruleset=DIRECT,https://raw.githubusercontent.com/zsokami/ACL4SSR/main/ChinaOnly.list
ruleset=🇨🇳直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaDomain.list
ruleset=🇨🇳直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list
ruleset=🇨🇳直连,[]GEOIP,LAN,no-resolve
ruleset=🇨🇳直连,[]GEOIP,CN,no-resolve
ruleset=🐠漏网之鱼,[]FINAL

# TUN配置
tun:
  enable: true
  stack: system
  dns-hijack:
    - 'any:53'
  auto-route: true
  auto-detect-interface: true
  mtu: 1280
  endpoint-independent-nat: true

# DNS 配置 - 蜂窝网络优化
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - '*.local'
    - 'localhost.ptlogin2.qq.com'
    - 'dns.msftncsi.com'
    - 'www.msftncsi.com'
    - 'www.msftconnecttest.com'

  # 国内DNS (优化顺序)
  nameserver:
    - 223.5.5.5     # 阿里DNS
    - 119.29.29.29  # 腾讯DNS备用

  # 国外DNS (优化顺序)
  fallback:
    - https://dns.google/dns-query     # 谷歌DNS
    - https://cloudflare-dns.com/dns-query # Cloudflare备用

  # 分流设置
  fallback-filter:
    geoip: true  # 使用GEOIP数据判断
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
      - 127.0.0.1/8
      - 0.0.0.0/32
    # 强制这些域名使用加密DNS解析
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
      - '+.twitter.com'
      - '+.instagram.com'
      - '+.netflix.com'
      - '+.telegram.org'
      - '+.github.com'
      - '+.reddit.com'
      - '+.wikipedia.org'
      - '+.cloudflare.com'
      - '+.discord.com'
      - '+.spotify.com'
      - '+.twitch.tv'
      - '+.amazon.com'
      - '+.github.io'
      - '+.medium.com'
      - '+.bing.com'
      - '+.microsoft.com'

  # 防止DNS污染
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29

  # DNS缓存设置
  caching: true
  cache-size: 2048

# 地理数据文件配置 - 针对中国大陆优化
geox-url:
  geoip: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://github.com/Loyalsoldier/clash-rules/releases/download/release/Country.mmdb"

geodata-mode: true
geodata-loader: memconservative
geoip-maxmind-compatibility: true

# Meta内核网络优化 (已验证支持)
unified-delay: true
tcp-concurrent: true
tcp-no-delay: true
keep-alive-interval: 30  # 降低到30秒，更适合蜂窝网络
udp-relay-mode: native   # 更适合中国移动网络的UDP中继模式

# 网络嗅探配置 (Meta核心特性)
sniffer:
  enable: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080]
  force-domain:
    - '+.google.com'
  skip-domain:
    - '+.qq.com'
    - '+.126.com'

# 蜂窝网络性能优化
dial-context-timeout: 20
tcp-fast-open: true
udp-timeout: 10
find-process-mode: off

# 流量和电池优化
rules-update-interval: 86400
proxy-providers-update-interval: 86400

# 连接失败处理
proxy-providers-health-check:
  enable: true
  timeout: 1000
  interval: 3600
  lazy: true
  check-count: 1
