[custom]

exclude_remarks=(Data Left|Remain:|Traffic:|Expir[ey]|Reset|(\d[\d.]*\s*[MG]B[^\dA-Za-z]+|[:：]\s*)\d[\d.]*\s*GB(?![\dA-Za-z])|剩[余餘]流量|流量：|[到过過效]期|[时時][间間]|重置|分割线|残り使用容量|有効期限|リセット|🔰 (ID|HSD|SNI):|📝 Gói:)

add_emoji=true
remove_old_emoji=false
emoji=(?!🇨🇳)[🇦-🇿]{2},
emoji=^(?!.*[🇦-🇿]{2}).*(美国|华盛顿|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|旧金山|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|纽约|丹佛|加利福尼亚|弗吉尼亚|得克萨斯|亚特兰大|佛罗里达|迈阿密|United States|Washington|Portland|Dallas|Oregon|Phoenix|Fremont|Silicon Valley|San Francisco|Las Vegas|Los Angeles|San Jose|Santa Clara|Seattle|Chicago|New York|Denver|California|Virginia|Texas|Atlanta|Florida|Miami),🇺🇸
emoji=^(?!.*[🇦-🇿]{2}).*(香港|Hong Kong),🇭🇰
emoji=^(?!.*[🇦-🇿]{2}).*(日本|东京|大阪|名古屋|埼玉|福冈|Japan|Tokyo|Osaka|Nagoya|Saitama|Fukuoka),🇯🇵
emoji=^(?!.*[🇦-🇿]{2}).*(新加坡|Singapore),🇸🇬
emoji=^(?!.*[🇦-🇿]{2}).*(台湾|台北|新北|彰化|高雄|Taiwan|Taipei|New Taipei|Changhua|Kaohsiung),🇹🇼
emoji=^(?!.*[🇦-🇿]{2}).*(英国|英格兰|伦敦|曼彻斯特|United Kingdom|England|London|Manchester),🇬🇧
emoji=^(?!.*[🇦-🇿]{2}).*(加拿大|多伦多|蒙特利尔|温哥华|Canada|Toronto|Montreal|Vancouver),🇨🇦
emoji=^(?!.*[🇦-🇿]{2}).*(德国|法兰克福|柏林|Germany|Frankfurt|Berlin),🇩🇪
emoji=^(?!.*[🇦-🇿]{2}).*(法国|巴黎|France|Paris),🇫🇷
emoji=^(?!.*[🇦-🇿]{2}).*(韩国|首尔|South Korea|Seoul),🇰🇷
emoji=^(?!.*[🇦-🇿]{2}).*(澳大利亚|悉尼|墨尔本|Australia|Sydney|Melbourne),🇦🇺
emoji=^(?!.*[🇦-🇿]{2}).*(俄罗斯|莫斯科|圣彼得堡|Russia|Moscow|Saint Petersburg),🇷🇺
emoji=^(?!.*[🇦-🇿]{2}).*(中国|深圳|北京|上海|广东|山东|湖北|湖南|天津|重庆|辽宁|吉林|黑龙江|江苏|浙江|安徽|福建|云南|四川|陕西|甘肃|青海|内蒙古|西藏|宁夏|新疆|China|Shenzhen|Beijing|Shanghai|Guangdong|Shandong|Hubei|Hunan|Tianjin|Chongqing|Liaoning|Jilin|Heilongjiang|Jiangsu|Zhejiang|Anhui|Fujian|Yunnan|Sichuan|Shanxi|Gansu|Qinghai|Inner Mongolia|Tibet|Ningxia|Xinjiang),🇨🇳
emoji=^(?!.*([🇦-🇿]{2}|ℹ️)).*(官.?网|官方|产品|平台|勿连|修复|恢复|更新|地址|网站|网址|域名|网域|浏览器|导航|搜|群|裙|聊|频道|电报|飞机|扣|微信|售后|客服|工单|联系|使用|购买|续费|订阅|公告|版本|出现|没网|情况|开通|数量|注|说明|通知|去除|过滤|@|：|(?i:(?<![\da-z])(tg|telegram|t\.me|qq?|vx?|wx)(?!\d*[a-z]|\d{1,3}(?!\d))|^[^:]+:(?![\da-f]{0,4}:|\s*\d{1,5}([/?]|\s*$)))),ℹ️

enable_rule_generator=true
overwrite_original_rules=true

custom_proxy_group=✈️起飞`select`[]⚡低延迟`[]🇭🇰香港`[]🇹🇼台湾`[]🇸🇬新加坡`[]🇯🇵日本`[]🇺🇸美国`[]🎏其他`[]👆🏻指定`[]DIRECT`[]REJECT
custom_proxy_group=⚡低延迟`url-test`.*`https://www.gstatic.com/generate_204`180,,50
custom_proxy_group=👆🏻指定`select`.*

custom_proxy_group=🛩️墙内`select`[]DIRECT`[]✈️起飞
custom_proxy_group=💩广告`select`[]REJECT`[]DIRECT`[]✈️起飞

custom_proxy_group=📺B站`select`[]🛩️墙内`[]DIRECT`[]🇭🇰香港`[]🇹🇼台湾
custom_proxy_group=🎬流媒体`select`[]✈️起飞`[]🇭🇰香港`[]🇹🇼台湾`[]🇸🇬新加坡`[]🇯🇵日本`[]🇺🇸美国`[]🎏其他`[]👆🏻指定
custom_proxy_group=🎬Netflix`select`[]🎬流媒体`[]✈️起飞`[]🇸🇬新加坡`[]🇭🇰香港`[]🇹🇼台湾`[]🇯🇵日本`[]🇺🇸美国`[]🎏其他
custom_proxy_group=🎬YouTube`select`[]🎬流媒体`[]✈️起飞`[]🇸🇬新加坡`[]🇭🇰香港`[]🇹🇼台湾`[]🇯🇵日本`[]🇺🇸美国
custom_proxy_group=📲社交媒体`select`[]✈️起飞`[]🇸🇬新加坡`[]🇭🇰香港`[]🇹🇼台湾`[]🇯🇵日本`[]🇺🇸美国`[]🎏其他`[]👆🏻指定
custom_proxy_group=📱电报`select`[]✈️起飞`[]🇸🇬新加坡`[]🇭🇰香港`[]🇹🇼台湾`[]🇯🇵日本`[]🇺🇸美国`[]🎏其他`[]👆🏻指定

custom_proxy_group=🤖AI`select`[]🇺🇸美国`[]🇹🇼台湾`[]🇸🇬新加坡`[]🇯🇵日本`[]✈️起飞`[]👆🏻指定
custom_proxy_group=🎮游戏平台`select`[]✈️起飞`[]DIRECT`[]🇺🇸美国`[]🇭🇰香港`[]🇹🇼台湾`[]🇸🇬新加坡`[]🇯🇵日本`[]🎏其他
custom_proxy_group=🛡️Google服务`select`[]✈️起飞`[]🇸🇬新加坡`[]🇭🇰香港`[]🇹🇼台湾`[]🇯🇵日本`[]🇺🇸美国`[]🎏其他`[]DIRECT
custom_proxy_group=Ⓜ️微软服务`select`[]DIRECT`[]✈️起飞`[]🇺🇸美国`[]🇭🇰香港`[]🇹🇼台湾`[]🇸🇬新加坡`[]🇯🇵日本
custom_proxy_group=🍎苹果服务`select`[]DIRECT`[]✈️起飞`[]🇺🇸美国`[]🇭🇰香港`[]🇹🇼台湾`[]🇸🇬新加坡`[]🇯🇵日本
custom_proxy_group=🟢Spotify`select`[]✈️起飞`[]🇺🇸美国`[]🇭🇰香港`[]🇹🇼台湾`[]🇸🇬新加坡`[]🇯🇵日本`[]DIRECT`[]🎏其他
custom_proxy_group=📧邮件服务`select`[]✈️起飞`[]DIRECT`[]🇺🇸美国`[]🇸🇬新加坡`[]🎏其他
custom_proxy_group=🔎搜索引擎`select`[]✈️起飞`[]🇺🇸美国`[]🇭🇰香港`[]🇹🇼台湾`[]🇸🇬新加坡`[]🇯🇵日本`[]DIRECT
custom_proxy_group=🐟漏网之鱼`select`[]✈️起飞`[]🛩️墙内`[]💩广告`[]DIRECT`[]👆🏻指定

custom_proxy_group=🇭🇰香港`url-test`(?i)港|hongkong|hk`https://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇹🇼台湾`url-test`(?i)台|taiwan|tw`https://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇸🇬新加坡`url-test`(?i)新|singapore|sg`https://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇯🇵日本`url-test`(?i)日|japan|jp`https://www.gstatic.com/generate_204`300,,50
custom_proxy_group=🇺🇸美国`url-test`(?i)美|states|us`https://www.gstatic.com/generate_204`300,,150
custom_proxy_group=🎏其他`url-test`^(?!.*(港|台|新|日|美|hongkong|hk|taiwan|tw|singapore|sg|japan|jp|states|us)).*$`https://www.gstatic.com/generate_204`300,,100

# 优化后的规则集合 - 将广告规则提前并增加新AI平台规则
# 广告和隐私保护规则 - 提前到最优先处理
ruleset=💩广告,clash-domain:https://anti-ad.net/clash.yaml
ruleset=💩广告,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanAD.list
ruleset=💩广告,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanProgramAD.list

# 本地网络访问规则
ruleset=DIRECT,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/LocalAreaNetwork.list
ruleset=DIRECT,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/UnBan.list

# AI服务 - 扩展AI平台规则
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.list
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Claude/Claude.list
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.list
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Anthropic/Anthropic.list
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Perplexity/Perplexity.list
# 新增AI平台规则
ruleset=🤖AI,https://raw.githubusercontent.com/mannixlee/custom-rules/main/midjourney.list
ruleset=🤖AI,https://raw.githubusercontent.com/mannixlee/custom-rules/main/stabilityai.list
ruleset=🤖AI,https://raw.githubusercontent.com/mannixlee/custom-rules/main/runwayml.list
ruleset=🤖AI,https://raw.githubusercontent.com/mannixlee/custom-rules/main/deepai.list

# 去重处理 - 使用优先级更高的proxy.txt替代ProxyGFWlist.list
# 国外网站 - 使用集中规则
ruleset=✈️起飞,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/master/proxy.txt
# ruleset=✈️起飞,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyGFWlist.list

# 重要应用单独分流 - 保留精细控制
# Telegram
ruleset=📱电报,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Telegram.list
ruleset=📱电报,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/master/telegramcidr.txt

# AI服务 - 保留精细控制
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.list
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Claude/Claude.list
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.list
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Anthropic/Anthropic.list
ruleset=🤖AI,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Perplexity/Perplexity.list

# 流媒体 - 使用集中规则
ruleset=📺B站,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/BilibiliHMT.list
ruleset=📺B站,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Bilibili.list
ruleset=🎬Netflix,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Netflix.list
ruleset=🎬YouTube,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/YouTube.list
ruleset=🟢Spotify,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Spotify.list
ruleset=🎬流媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyMedia.list

# 主要服务提供商 - 使用集中规则
ruleset=🛡️Google服务,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Google.list
ruleset=🍎苹果服务,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Apple.list
ruleset=Ⓜ️微软服务,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Microsoft.list
ruleset=📧邮件服务,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Mail.list

# 开发和社交媒体
ruleset=✈️起飞,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/GitHub.list
ruleset=🎮游戏平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Steam.list
ruleset=🎮游戏平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Epic.list
ruleset=📲社交媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Twitter.list
ruleset=📲社交媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Instagram.list
ruleset=📲社交媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Discord.list
ruleset=📲社交媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/TikTok.list

# 中国大陆域名和IP - 使用集中规则，替代几十个分散规则
ruleset=🛩️墙内,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaDomain.list
ruleset=🛩️墙内,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list
ruleset=🛩️墙内,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Download.list
ruleset=🛩️墙内,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaMedia.list
ruleset=🛩️墙内,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/master/applications.txt
ruleset=🛩️墙内,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/master/direct.txt
ruleset=🛩️墙内,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/master/private.txt
ruleset=🛩️墙内,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/master/cncidr.txt
ruleset=🛩️墙内,[]GEOIP,CN,no-resolve

# 重要的国内服务单独分流 - 确保稳定性
ruleset=🛩️墙内,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/WeChat.list
ruleset=🛩️墙内,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Alipay.list
ruleset=🛩️墙内,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/UnionPay.list

# 国外网站 - 使用集中规则
ruleset=✈️起飞,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/master/proxy.txt
# ruleset=✈️起飞,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyGFWlist.list

# 兜底规则
ruleset=🐟漏网之鱼,[]FINAL

# Clash核心配置
mixed-port: 10808
allow-lan: true
bind-address: '*'
mode: rule
log-level: warning
ipv6: false
external-controller: 127.0.0.1:9090
external-ui: dashboard
secret: ""

# DNS配置 - 实现DNS策略优化
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  use-hosts: true
  preload-domain: true
  nameserver-cache-size: 4096
  prefer-h3: true

  # DNS预热功能 - 预解析常用域名
  prefetch-domain: true
  prefetch-domains:
    - 'google.com'
    - 'youtube.com'
    - 'facebook.com'
    - 'twitter.com'
    - 'netflix.com'
    - 'github.com'
    - 'openai.com'
    - 'bing.com'
    - 'baidu.com'
    - 'qq.com'
    - 'bilibili.com'
    - 'alipay.com'
    - 'taobao.com'

  # DoH负载均衡 - 为每家服务商设置多个端点
  doh-server-balancing: true

  # 主要DNS服务器配置 - 实现负载均衡
  nameserver:
    # 阿里云DNS负载均衡
    - https://dns.alidns.com/dns-query           # 阿里主端点
    - https://223.6.6.6/dns-query                # 阿里备用端点
    # 谷歌DNS负载均衡
    - https://dns.google/dns-query               # 谷歌主端点
    - https://8.8.8.8/dns-query                  # 谷歌备用端点
    # 腾讯DNS作为备用
    - https://doh.pub/dns-query                  # 腾讯主端点
    - 223.6.6.6                                  # 阿里非加密备用

  # EDNS Client Subnet支持
  edns-client-subnet:
    enable: true
    policy: prefer-precision       # 优先精确
    custom-subnet: "224.0.0.0/24"  # 自定义子网

  # 默认DNS服务器 - 阿里DNS优先
  default-nameserver:
    - 223.6.6.6      # 阿里DNS (优先)
    - 119.29.29.29   # 腾讯DNS (备用)
    - 8.8.8.8        # Google DNS (备用)

  # 主要DNS服务器 - 阿里云优先，谷歌次之
  nameserver:
    - https://dns.alidns.com/dns-query # 阿里DOH (国内优先)
    - https://dns.google/dns-query     # Google DOH (国外优先)
    - https://doh.pub/dns-query        # 腾讯DOH (备用)
    - 223.6.6.6                        # 阿里DNS (非加密备用)

  # 国外回落DNS - 谷歌优先
  fallback:
    - https://dns.google/dns-query        # Google DOH (优先)
    - https://cloudflare-dns.com/dns-query # Cloudflare DOH (备用)
    - https://doh.opendns.com/dns-query    # OpenDNS DOH (备用)

  # 代理模式DNS
  proxy-server-nameserver:
    - https://dns.google/dns-query         # Google DOH (优先)

  # 域名解析策略 - 国内外分离策略，阿里和谷歌优先
  nameserver-policy:
    # 国内网站优先使用阿里DNS
    'geosite:cn,category-games-cn': [https://dns.alidns.com/dns-query, 223.6.6.6]
    'geosite:microsoft-cn,apple-cn': [https://dns.alidns.com/dns-query, 223.6.6.6]
    # 国外网站优先使用谷歌DNS
    'geosite:geolocation-!cn': [https://dns.google/dns-query]
    'geosite:category-dev,category-science': [https://dns.google/dns-query]
    # 广告域名
    'geosite:category-ads-all': [https://dns.alidns.com/dns-query]
    # 金融服务 - 使用阿里DNS
    'geosite:category-finance': [https://dns.alidns.com/dns-query, 223.6.6.6]
    # 微软服务 - 谷歌DNS
    'domain:office.com,domain:office365.com,domain:sharepoint.com,domain:microsoft.com': [https://dns.google/dns-query]
    # 社交媒体 - 谷歌DNS
    'domain:twitter.com,domain:instagram.com,domain:facebook.com,domain:whatsapp.com': [https://dns.google/dns-query]
    # GitHub和开发相关 - 谷歌DNS
    'domain:github.com,domain:githubusercontent.com,domain:ghcr.io,domain:githubassets.com': [https://dns.google/dns-query]
    # 国内CDN - 阿里DNS
    'domain:cdn.jsdelivr.net': [https://dns.alidns.com/dns-query, 223.6.6.6]
    'domain:fastly.net': [https://dns.alidns.com/dns-query]
    'domain:akamaiedge.net': [https://dns.alidns.com/dns-query]
    # 国外CDN - 谷歌DNS
    'domain:cloudfront.net': [https://dns.google/dns-query]
    # 流媒体服务 - 谷歌DNS
    'domain:netflix.com,domain:nflxvideo.net,domain:nflxso.net,domain:nflxext.com': [https://dns.google/dns-query]
    'domain:youtube.com,domain:googlevideo.com,domain:ytimg.com': [https://dns.google/dns-query]
    # AI服务 - 谷歌DNS
    'domain:openai.com,domain:anthropic.com,domain:claude.ai,domain:suno.ai,domain:perplexity.ai': [https://dns.google/dns-query]

  # 域名TTL设置 - 移动网络环境增强缓存
  domain-ttl:
    'apple.com': 7200        # 增加TTL减少移动网络查询
    'microsoft.com': 7200
    'qq.com': 7200
    'taobao.com': 7200
    'baidu.com': 7200
    'jd.com': 7200
    'google.com': 7200
    'youtube.com': 7200
    'netflix.com': 7200
    'github.com': 7200
    'cloudflare.com': 7200
    'openai.com': 7200
    'alipay.com': 3600       # 金融服务适度TTL
    'weixin.qq.com': 3600
    'zhihu.com': 3600
    'bilibili.com': 3600

# TUN模式配置 - 移动网络优化
tun:
  enable: true
  stack: gvisor
  dns-hijack:
    - any:53
    - tcp://any:53
  auto-route: true
  auto-detect-interface: true
  mtu: 1280                  # 更适合移动网络的MTU值
  tcp-balance: true
  udp-balance: true
  stack-buffer: 2048         # 减小以节省移动设备内存
  endpoint-independent-nat: true

  # 移动设备优化参数 - 增强移动网络适应性
  mobile-settings:
    mobile-mtu: 1280
    roaming-mtu: 1024
    low-battery-optimizations: true
    weak-signal-optimizations: true
    battery-life-extender: true
    # 新增: 网络切换优化
    network-switch-optimization: true
    # 新增: 数据节省模式
    data-saving-mode: true

# 性能优化配置 - 针对移动设备资源限制
tcp-concurrent: true
tcp-concurrent-max: 256      # 减少以适应移动设备
tcp-concurrent-reuse: true
tcp-fast-open-queue: 256
tcp-no-delay: true
inbound-tfo: true
outbound-tfo: true
inbound-buffer-size: 4096    # 减小缓冲区以节省内存
outbound-buffer-size: 4096
buffer-size: 8192

# 连接参数 - 适应移动网络特性
connection-timeout: 8        # 增加超时时间
dial-timeout: 5
keep-alive-interval: 45      # 移动网络下更合理的保活间隔
find-process-refresh-interval: 60
disable-logger: true

auto-reconnect: true
reconnect-interval: 5        # 适应移动网络波动

# 缓存配置 - 移动网络优化增强版
cache:
  enable: true
  size: 10240                # 增大缓存减少网络请求
  ttl: 7200                  # 更长的TTL
  store-fakeip: true
  persistence: true
  memory-ratio: 0.3
  disk-ratio: 0.7
  optimistic-dns: true

rule-cache:
  enable: true
  size: 12288                # 增大规则缓存
  ttl: 10800                 # 更长的TTL减少刷新频率

# 电池优化策略 - 移动设备重点优化
battery-saver:
  enable: true
  threshold: 25              # 更早开始省电模式
  save-mode:
    tcp-concurrent: false
    keep-alive-interval: 90
    sniff: selective
    reduce-dns-queries: true
    defer-non-critical: true
    increase-cache-usage: true
    # 新增: 减少后台活动
    reduce-background-activity: true
    # 新增: 降低优先级
    lower-priority-non-essential: true

# 网络配置 - 只保留移动网络相关配置
network-profiles:
  mobile:
    buffer-size: 4096        # 更小的缓冲区
    tcp-concurrent: selective
    keep-alive-interval: 60
    dns-prefetch: conservative
    max-connections: 96      # 减少最大连接数
    idle-timeout: 180
    data-saving: true
    battery-aware: true
  roaming:
    buffer-size: 2048        # 漫游时最小化资源使用
    tcp-concurrent: false
    keep-alive-interval: 120
    dns-prefetch: disabled
    max-connections: 48
    idle-timeout: 60
    minimal-operations: true
    aggressive-caching: true

# 流量控制 - 移动网络数据节省
traffic-control:
  enable: true
  mobile-data-compression: true
  roaming-compression: true
  low-battery-control: true
  priorities:
    foreground: high
    background: low
  network-quality-awareness: true
  bandwidth-management:
    mobile-limit: strict
    roaming-limit: aggressive

# URL测试 - 移动网络优化
url-test:
  mobile-test-interval: 900  # 减少测试频率节省流量
  roaming-test-interval: 1800
  low-battery-test-interval: 1800
  timeout: 5                 # 适应移动网络延迟
  adaptive-interval: true
  network-quality-aware: true

# 网络质量感知增强 - 实现方案
network-quality-sensing:
  enable: true
  # 网络切换平滑过渡
  smooth-transition:
    enable: true
    connection-maintain: 5  # 保持连接5秒以实现平滑过渡
    priority-connection: true  # 优先保障重要连接

  # 信号强度自适应
  signal-adaptive:
    enable: true
    weak-signal-strategy: conservative  # 弱信号下保守策略
    strong-signal-strategy: aggressive  # 强信号下激进策略
    update-interval: 10                 # 10秒更新一次

  # 智能拥塞控制
  congestion-control:
    enable: true
    algorithm: bbr          # 默认使用BBR
    auto-switch: true       # 自动切换算法
    poor-network-algorithm: cubic  # 差网络下使用cubic
    network-monitor-interval: 10   # 监控间隔

# 特殊网络模式 - 实现特殊场景支持
special-network-modes:
  # 高延迟网络模式 - 卫星网络或高ping值情况
  high-latency-mode:
    enable: false  # 默认不启用
    trigger-latency: 300  # 超过300ms延迟时触发
    max-concurrent: 32    # 限制并发连接
    timeout-multiplier: 3  # 超时时间乘数
    aggressive-caching: true  # 激进缓存
    reduced-keepalive: true   # 减少keepalive

  # 数据节省极致模式
  extreme-data-saving:
    enable: false  # 默认不启用
    compression-level: maximum  # 最大压缩
    image-quality-reduction: true  # 降低图片质量
    disable-preload: true  # 禁用预加载
    minimal-connections: true  # 最小化连接数
    cache-everything: true  # 缓存所有内容

  # 隐私增强模式
  enhanced-privacy:
    enable: false  # 默认不启用
    rotate-user-agent: true  # 轮换UA
    prevent-fingerprinting: true  # 防止指纹追踪
    dns-over-https-only: true  # 仅使用DoH
    block-trackers: true  # 拦截跟踪器
    strict-sns: true  # 严格SNI

# 兼容性与防护 - 实现防探测和混淆
gfw-protection:
  # 增强GFW防探测
  enhanced-stealth:
    enable: true
    tls-fragmentation: true  # TLS分片
    packet-delay-variation: true  # 数据包延迟变化
    avoid-pattern-traffic: true  # 避免特征流量

  # 协议混淆增强
  protocol-obfuscation:
    enable: true
    tls-fingerprint: chrome  # 使用Chrome指纹
    http-header-obfuscation: true  # HTTP头部混淆
    timing-simulation: true  # 模拟真实时间特征

  # 备用连接策略
  fallback-strategy:
    enable: true
    fallback-sequence:
      - tls-direct  # 首选TLS直连
      - tls-obfs    # 备选TLS混淆
      - ws-tls      # 备选WS+TLS
      - grpc        # 最后选择gRPC
    auto-retry: true  # 自动重试
    max-retries: 3    # 最多重试3次

# 在profile部分添加元数据以便识别优化版本
profile:
  store-selected: true
  store-fake-ip: true
  tracing: false
  optimized-version: "enhanced-mobile-1.0"  # 添加版本标识
  optimizations-applied:
    - "rule-optimization"
    - "dns-enhancement"
    - "network-quality"
    - "special-modes"
    - "privacy-protection"
