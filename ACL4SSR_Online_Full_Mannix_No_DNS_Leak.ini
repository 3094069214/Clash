# 针对中国大陆移动手机蜂窝数据网络优化的Mihomo(Meta)内核配置文件
[custom]

# 基础设置
exclude_remarks=(Data Left|Remain:|Traffic:|Expir[ey]|Reset|(\d[\d.]*\s*[MG]B[^\dA-Za-z]+|[:：]\s*)\d[\d.]*\s*GB(?![\dA-Za-z])|剩[余餘]流量|流量：|[到过過效]期|[时時][间間]|重置|分割线|残り使用容量|有効期限|リセット|🔰 (ID|HSD|SNI):|📝 Gói:)

# Emoji 设置
add_emoji=true
remove_old_emoji=true
emoji=(?!🇨🇳)[🇦-🇿]{2},
emoji=^(?!.*[🇦-🇿]{2}).*(美国|华盛顿|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|旧金山|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|纽约|丹佛|加利福尼亚|弗吉尼亚|得克萨斯|亚特兰大|佛罗里达|迈阿密|US|USA|United States|Washington|Portland|Dallas|Oregon|Phoenix|Fremont|Silicon Valley|San Francisco|Las Vegas|Los Angeles|San Jose|Santa Clara|Seattle|Chicago|New York|Denver|California|Virginia|Texas|Atlanta|Florida|Miami),🇺🇸
emoji=^(?!.*[🇦-🇿]{2}).*(香港|HK|Hong Kong),🇭🇰
emoji=^(?!.*[🇦-🇿]{2}).*(日本|东京|大阪|名古屋|埼玉|福冈|JP|Japan|Tokyo|Osaka|Nagoya|Saitama|Fukuoka),🇯🇵
emoji=^(?!.*[🇦-🇿]{2}).*(新加坡|狮城|SG|Singapore),🇸🇬
emoji=^(?!.*[🇦-🇿]{2}).*(台湾|台北|新北|彰化|高雄|TW|Taiwan|Taipei|New Taipei|Changhua|Kaohsiung),🇹🇼
emoji=^(?!.*[🇦-🇿]{2}).*(英国|英格兰|伦敦|曼彻斯特|UK|United Kingdom|England|London|Manchester),🇬🇧
emoji=^(?!.*[🇦-🇿]{2}).*(加拿大|多伦多|蒙特利尔|温哥华|CA|Canada|Toronto|Montreal|Vancouver),🇨🇦
emoji=^(?!.*[🇦-🇿]{2}).*(德国|法兰克福|柏林|DE|Germany|Frankfurt|Berlin),🇩🇪
emoji=^(?!.*[🇦-🇿]{2}).*(法国|巴黎|FR|France|Paris),🇫🇷
emoji=^(?!.*[🇦-🇿]{2}).*(韩国|首尔|KR|Korea|South Korea|Seoul),🇰🇷
emoji=^(?!.*[🇦-🇿]{2}).*(澳大利亚|悉尼|墨尔本|AU|Australia|Sydney|Melbourne),🇦🇺
emoji=^(?!.*[🇦-🇿]{2}).*(俄罗斯|莫斯科|圣彼得堡|RU|Russia|Moscow|Saint Petersburg),🇷🇺
emoji=^(?!.*([🇦-🇿]{2}|ℹ️)).*(官.?网|官方|产品|平台|勿连|修复|恢复|更新|地址|网站|网址|域名|网域|浏览器|导航|搜|群|裙|聊|频道|电报|飞机|扣|微信|售后|客服|工单|联系|使用|购买|续费|订阅|公告|版本|出现|没网|情况|开通|数量|注|说明|通知|去除|过滤|@|：|(?i:(?<![\da-z])(tg|telegram|t\.me|qq?|vx?|wx)(?!\d*[a-z]|\d{1,3}(?!\d))|^[^:]+:(?![\da-f]{0,4}:|\s*\d{1,5}([/?]|\s*$)))),ℹ️

enable_rule_generator=true
overwrite_original_rules=true

# 代理分组 - 优化配置
custom_proxy_group=🚀 全局代理`select`[]⚡ 最低延迟`[]🇭🇰 香港`[]🇸🇬 新加坡`[]🇯🇵 日本`[]🇺🇸 美国`[]🇹🇼 台湾`[]🌍 其他`[]🔍 手动选择`[]DIRECT`[]REJECT
custom_proxy_group=⚡ 最低延迟`url-test`.*`http://www.gstatic.com/generate_204`900,,50,200
custom_proxy_group=🔍 手动选择`select`.*

# 地区分组 - 排序优化
custom_proxy_group=🇭🇰 香港`url-test`(?i)(?=.*(港|香港|HK|Hong))(?!.*(回国|校园|游戏|GAME)).*`http://www.gstatic.com/generate_204`1200,,80
custom_proxy_group=🇸🇬 新加坡`url-test`(?i)(?=.*(新|狮|獅|新加坡|SG|Singapore))(?!.*(回国|校园|游戏|GAME)).*`http://www.gstatic.com/generate_204`1200,,80
custom_proxy_group=🇯🇵 日本`url-test`(?i)(?=.*(日|日本|JP|Japan))(?!.*(回国|校园|游戏|GAME)).*`http://www.gstatic.com/generate_204`1200,,80
custom_proxy_group=🇺🇸 美国`url-test`(?i)(?=.*(美|美国|美國|US|USA|States))(?!.*(回国|校园|游戏|GAME)).*`http://www.gstatic.com/generate_204`1200,,80
custom_proxy_group=🇹🇼 台湾`url-test`(?i)(?=.*(台|台湾|台灣|TW|Taiwan))(?!.*(回国|校园|游戏|GAME)).*`http://www.gstatic.com/generate_204`1200,,80
custom_proxy_group=🌍 其他`select`^(?!.*(港|香港|HK|Hong|台|台湾|台灣|TW|Taiwan|日|日本|JP|Japan|新|狮|獅|新加坡|SG|Singapore|美|美国|美國|US|USA|States|回国|校园|游戏|GAME)).*$

# 应用分组 - 简化配置
custom_proxy_group=🌐 国际网站`select`[]🚀 全局代理`[]🇺🇸 美国`[]🇭🇰 香港`[]🇸🇬 新加坡`[]🇯🇵 日本`[]🇹🇼 台湾`[]🌍 其他
custom_proxy_group=📺 流媒体`select`[]🚀 全局代理`[]🇭🇰 香港`[]🇹🇼 台湾`[]🇸🇬 新加坡`[]🇯🇵 日本`[]🇺🇸 美国`[]🌍 其他
custom_proxy_group=💬 社交聊天`select`[]DIRECT`[]🚀 全局代理`[]🇭🇰 香港`[]🇸🇬 新加坡`[]🇺🇸 美国
custom_proxy_group=🇨🇳 国内网站`select`[]DIRECT`[]🚀 全局代理
custom_proxy_group=📱 短视频`select`[]DIRECT`[]🚀 全局代理
custom_proxy_group=🛒 购物平台`select`[]DIRECT`[]🚀 全局代理
custom_proxy_group=🎮 游戏直播`select`[]DIRECT`[]🚀 全局代理
custom_proxy_group=📢 广告拦截`select`[]REJECT`[]DIRECT`[]🚀 全局代理
custom_proxy_group=🐟 漏网之鱼`select`[]🚀 全局代理`[]DIRECT`[]🔍 手动选择

# 分流规则 - 精简高效版
# 修改分组引用
ruleset=DIRECT,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/LocalAreaNetwork.list
ruleset=🇨🇳 国内网站,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/UnionPay.list
ruleset=🇨🇳 国内网站,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/AliPay.list
ruleset=💬 社交聊天,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/WeChat.list
ruleset=💬 社交聊天,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Tencent.list
ruleset=📢 广告拦截,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyListChina.list
ruleset=📱 短视频,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/DouYin.list
ruleset=🛒 购物平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Taobao.list
ruleset=🛒 购物平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/JingDong.list
ruleset=🇨🇳 国内网站,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ByteDance/ByteDance_Classical.yaml
ruleset=🇨🇳 国内网站,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Alibaba/Alibaba_Classical.yaml
ruleset=🇨🇳 国内网站,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Baidu/Baidu_Classical.yaml
ruleset=📺 流媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/YouTube.list
ruleset=🌐 国际网站,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Google.list
ruleset=🌐 国际网站,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Telegram.list
ruleset=🚀 全局代理,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyGFWlist.list
ruleset=DIRECT,https://raw.githubusercontent.com/zsokami/ACL4SSR/main/ChinaOnly.list
ruleset=🇨🇳 国内网站,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaDomain.list
ruleset=🇨🇳 国内网站,[]GEOIP,CN,no-resolve
ruleset=🐟 漏网之鱼,[]FINAL

# TUN配置 - 蜂窝网络优化
tun:
  enable: true
  stack: system
  dns-hijack:
    - 'any:53'
  auto-route: true
  auto-detect-interface: true
  mtu: 1200  # 更适合中国移动网络
  endpoint-independent-nat: true
  strict-route: true  # 增强防泄漏能力

# DNS 配置 - 蜂窝网络优化
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - '*.local'
    - 'localhost.ptlogin2.qq.com'
    - 'dns.msftncsi.com'
    - 'www.msftconnecttest.com'
    - '+.stun.*.*'
    - '+.stun.*.*.*'
    - '+.stun.*.*.*.*'

  # 国内DNS - 针对移动网络优化
  nameserver:
    - 223.6.6.6    # 阿里备用DNS，多地区优化
    - 119.29.29.29 # 腾讯DNS
    - 114.114.114.114 # 通用备用

  # 国外DNS - 更可靠的加密DNS
  fallback:
    - tls://8.8.8.8:853  # Google DoT
    - tls://1.1.1.1:853  # Cloudflare DoT
    - https://dns.google/dns-query  # Google DoH

  # 分流设置 - 更精确控制
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
      - 0.0.0.0/32
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
      - '+.github.com'
      - '+.wikipedia.org'

  # 防DNS污染设置
  default-nameserver:
    - 223.6.6.6
    - 119.29.29.29

  # DNS缓存设置 - 移动网络优化
  caching: true
  cache-size: 8192  # 增大缓存，减少查询

# Mihomo内核网络优化参数
unified-delay: true
tcp-concurrent: true
tcp-no-delay: true
tcp-fast-open: true
buffer-pkts: true
sniff-pure-tls: true
udp-relay-mode: native
keep-alive-interval: 15  # 更激进的保活间隔
proxy-reject-drop: true  # 拒绝直接丢弃，节约资源

# 地理数据文件配置 - 针对中国大陆优化
geox-url:
  geoip: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/country-lite.mmdb"  # 更轻量版本

geodata-mode: true
geodata-loader: memconservative
geoip-maxmind-compatibility: true

# 网络嗅探配置 - 流量节约版
sniffer:
  enable: true
  force-dns-mapping: true  # 强制DNS映射提高准确性
  parse-pure-ip: true      # 解析纯IP
  override-destination: true
  sniff:
    TLS:
      ports: [443]
    HTTP:
      ports: [80]

# 蜂窝网络性能参数优化
dial-context-timeout: 8  # 降低超时，更快失败切换
find-process-mode: off   # 关闭进程查找，节约资源
default-interface-name: en0  # 默认接口名，移动设备常用

# 连接控制
proxy-check-ip-version: false  # 不检查IP版本，节约资源连接时间
disable-fake-ip-v6: true      # 禁用Fake-IP的IPv6支持
disable-udp-traffic: false    # 保持UDP功能但不主动测试

# 资源管理
profile:
  store-selected: true
  store-fake-ip: true
