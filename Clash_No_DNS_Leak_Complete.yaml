# ========== Clash 完整配置 - 移动设备优化版 ==========
# 适合直接上传到GitHub并通过URL引用

# ========== Emoji配置 ==========
emoji:
  # 基础国旗映射
  '(?!🇨🇳)[🇦-🇿]{2}': '&$0'
  # 美国节点
  '^(?!.*[🇦-🇿]{2}).*(美国|华盛顿|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|旧金山|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|纽约|丹佛|加利福尼亚|弗吉尼亚|得克萨斯|亚特兰大|佛罗里达|迈阿密|United States|Washington|Portland|Dallas|Oregon|Phoenix|Fremont|Silicon Valley|San Francisco|Las Vegas|Los Angeles|San Jose|Santa Clara|Seattle|Chicago|New York|Denver|California|Virginia|Texas|Atlanta|Florida|Miami)': '🇺🇸'
  # 香港节点
  '^(?!.*[🇦-🇿]{2}).*(香港|Hong Kong)': '🇭🇰'
  # 日本节点
  '^(?!.*[🇦-🇿]{2}).*(日本|东京|大阪|名古屋|埼玉|福冈|Japan|Tokyo|Osaka|Nagoya|Saitama|Fukuoka)': '🇯🇵'
  # 新加坡节点
  '^(?!.*[🇦-🇿]{2}).*(新加坡|Singapore)': '🇸🇬'
  # 台湾节点
  '^(?!.*[🇦-🇿]{2}).*(台湾|台北|新北|彰化|高雄|Taiwan|Taipei|New Taipei|Changhua|Kaohsiung)': '🇹🇼'
  # 英国节点
  '^(?!.*[🇦-🇿]{2}).*(英国|英格兰|伦敦|曼彻斯特|United Kingdom|England|London|Manchester)': '🇬🇧'
  # 加拿大节点
  '^(?!.*[🇦-🇿]{2}).*(加拿大|多伦多|蒙特利尔|温哥华|Canada|Toronto|Montreal|Vancouver)': '🇨🇦'
  # 德国节点
  '^(?!.*[🇦-🇿]{2}).*(德国|法兰克福|柏林|Germany|Frankfurt|Berlin)': '🇩🇪'
  # 法国节点
  '^(?!.*[🇦-🇿]{2}).*(法国|巴黎|France|Paris)': '🇫🇷'
  # 韩国节点
  '^(?!.*[🇦-🇿]{2}).*(韩国|首尔|South Korea|Seoul)': '🇰🇷'
  # 澳大利亚节点
  '^(?!.*[🇦-🇿]{2}).*(澳大利亚|悉尼|墨尔本|Australia|Sydney|Melbourne)': '🇦🇺'
  # 俄罗斯节点
  '^(?!.*[🇦-🇿]{2}).*(俄罗斯|莫斯科|圣彼得堡|Russia|Moscow|Saint Petersburg)': '🇷🇺'
  # 中国节点
  '^(?!.*[🇦-🇿]{2}).*(中国|深圳|北京|上海|广东|山东|湖北|湖南|天津|重庆|辽宁|吉林|黑龙江|江苏|浙江|安徽|福建|云南|四川|陕西|甘肃|青海|内蒙古|西藏|宁夏|新疆|China|Shenzhen|Beijing|Shanghai|Guangdong|Shandong|Hubei|Hunan|Tianjin|Chongqing|Liaoning|Jilin|Heilongjiang|Jiangsu|Zhejiang|Anhui|Fujian|Yunnan|Sichuan|Shanxi|Gansu|Qinghai|Inner Mongolia|Tibet|Ningxia|Xinjiang)': '🇨🇳'
  # 信息节点
  '^(?!.*([🇦-🇿]{2}|ℹ️)).*(官.?网|官方|产品|平台|勿连|修复|恢复|更新|地址|网站|网址|域名|网域|浏览器|导航|搜|群|裙|聊|频道|电报|飞机|扣|微信|售后|客服|工单|联系|使用|购买|续费|订阅|公告|版本|出现|没网|情况|开通|数量|注|说明|通知|去除|过滤|@|：|(?i:(?<![\da-z])(tg|telegram|t\.me|qq?|vx?|wx)(?!\d*[a-z]|\d{1,3}(?!\d))|^[^:]+:(?![\da-f]{0,4}:|\s*\d{1,5}([/?]|\s*$))))': 'ℹ️'

# 节点排除规则
exclude:
  - 'Data Left'
  - 'Remain:'
  - 'Traffic:'
  - 'Expiry'
  - 'Expire'
  - 'Reset'
  - '(\d[\d.]*\s*[MG]B[^\dA-Za-z]+|[:：]\s*)\d[\d.]*\s*GB(?![\dA-Za-z])'
  - '剩[余餘]流量'
  - '流量：'
  - '[到过過效]期'
  - '[时時][间間]'
  - '重置'
  - '分割线'
  - '残り使用容量'
  - '有効期限'
  - 'リセット'
  - '🔰 (ID|HSD|SNI):'
  - '📝 Gói:'

# ========== 网络基础设置 ==========
mixed-port: 7890
allow-lan: true
bind-address: '*'
mode: rule
log-level: silent
ipv6: false
external-controller: 127.0.0.1:9090
external-ui: dashboard
secret: ""

# 性能优化
unified-delay: true
tcp-concurrent: true
keep-alive-interval: 25
find-process-mode: strict

# 网络嗅探配置
sniffer:
  enable: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8090]
  force-domain:
    - '*.google.com'
    - '*.facebook.com'
    - '*.youtube.com'
    - '*.netflix.com'
    - '*.openai.com'
  skip-domain:
    - 'Mijia Cloud'
    - '*.alipay.com'
    - '*.taobao.com'
    - '*.jd.com'
    - '*.qq.com'
    - '*.weixin.qq.com'
    - '*.baidu.com'
    - '*.kuaishou.com'
    - '*.pinduoduo.com'
    - '*.4399.com'
    - '*.bilibili.com'
    - '*.douyin.com'
    - '*.tencent.com'
    - '*.mihoyo.com'
    - '*.weibo.com'
    - '*.iqiyi.com'
    - '*.xiaomi.com'
    - '*.huawei.com'
    - '*.meituan.com'
    - '*.ele.me'

# TUN模式配置
tun:
  enable: true
  stack: system
  dns-hijack:
    - any:53
    - tcp://any:53
    - udp://any:53
  auto-route: true
  auto-detect-interface: true
  strict-route: false
  mtu: 9000
  inet4-route-address:
    - 0.0.0.0/1
    - 128.0.0.0/1
  endpoint-independent-nat: true
  include-android-user:
    - 0
    - 10
  stack-option:
    mtu: 9000
    gso: true

# DNS配置
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*.lan'
    - 'localhost.ptlogin2.qq.com'
    - '*.qq.com'
    - '*.alipay.com'
    - '*.taobao.com'
    - '*.tmall.com'
    - '*.jd.com'
    - '*.baidu.com'
    - '*.weixin.qq.com'
    - 'mtalk.google.com'
    - 'lens.l.google.com'
    - 'dl.google.com'
    - 'dl.l.google.com'
    - 'update.googleapis.com'
    - '*.kuaishou.com'
    - '*.douyin.com'
    - '*.tiktokv.com'
    - '*.snssdk.com'
    - '*.amemv.com'
    - '*.xiaohongshu.com'
    - '*.meituan.com'
    - '*.pinduoduo.com'
    - '*.icloud.com'
    - '*.icloud-content.com'
    - '*.tencent.com'
    - '*.tencent-cloud.net'
    - '*.bilibili.com'
    - '*.bilivideo.com'
    - '*.hdslb.com'
    - 'connect.rom.miui.com'
    - '*.cmpassport.com'
    - '*.10010.com'
    - '*.189.cn'
    - '*.10086.cn'
    - '*.iflytek.com'
    - '*.kugou.com'
    - '*.kuwo.cn'
    - '*.iqiyi.com'
    - '*.qiyi.com'
    - '*.cctv.com'
    - '*.youku.com'
    - '*.mgtv.com'
    - 'weixin.qq.com'
    - '*.weibo.com'
    - '*.aliyun.com'
    - '*.aliyuncs.com'
    - '*.csdn.net'
    - '*.netease.com'
  use-hosts: true
  nameserver-cache-size: 4096
  cache-size: 8192
  cache-expire: 1800
  prefer-h3: false

  default-nameserver:
    - 223.6.6.6
    - 119.29.29.29

  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
    - 223.5.5.5

  fallback:
    - https://dns.google/dns-query
    - https://cloudflare-dns.com/dns-query
    - 8.8.8.8

  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
      - 127.0.0.1/8
      - 0.0.0.0/32
      - 100.64.0.0/10
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
      - '+.github.com'
      - '+.twitter.com'
      - '+.instagram.com'
      - '+.netflix.com'
      - '+.openai.com'
      - '+.telegram.org'
      - '+.discord.com'
      - '+.medium.com'
      - '+.reddit.com'
      - '+.spotify.com'
      - '+.linkedin.com'
      - '+.notion.so'
      - '+.dropbox.com'

# 网络优化设置
url-test-interval: 3600
connection-test-url: https://cp.cloudflare.com/generate_204
test-timeout: 3
tolerance: 150

# 移动设备优化
profile:
  store-selected: true
  store-fake-ip: true
proxy-groups-first: true
global-client-fingerprint: chrome
tcp-connection-reuse: true
geodata-mode: true
disable-udp-traffic: false
udp-forward-policy: preferIPv4

# 移动网络防劫持优化
experimental:
  ignore-resolve-fail: true
  sniff-tls-sni: true
  udp-relay-mode: Compatible
  doh3-fingerprint: chrome

# 隐私增强
private-relay: true
remote-dns-resolve: true

# ========== 代理组配置 ==========
proxy-groups:
  # 主要代理组
  - name: ✈️起飞
    type: select
    proxies:
      - ⚡低延迟
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇸🇬新加坡
      - 🇯🇵日本
      - 🇺🇸美国
      - 🎏其他
      - 👆🏻指定
      - DIRECT
      - REJECT

  - name: ⚡低延迟
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 300
    tolerance: 50
    proxies:
      - DIRECT # 这里会被自动替换为所有节点

  - name: 👆🏻指定
    type: select
    proxies:
      - DIRECT # 这里会被自动替换为所有节点

  # 直连和拦截
  - name: 🛩️墙内
    type: select
    proxies:
      - DIRECT
      - ✈️起飞

  - name: 💩广告
    type: select
    proxies:
      - REJECT
      - DIRECT
      - ✈️起飞

  # 流媒体分组
  - name: 📺B站
    type: select
    proxies:
      - 🛩️墙内
      - DIRECT
      - 🇭🇰香港
      - 🇹🇼台湾

  - name: 🎬流媒体
    type: select
    proxies:
      - ✈️起飞
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇸🇬新加坡
      - 🇯🇵日本
      - 🇺🇸美国
      - 🎏其他
      - 👆🏻指定

  - name: 🎬Netflix
    type: select
    proxies:
      - 🎬流媒体
      - ✈️起飞
      - 🇸🇬新加坡
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇯🇵日本
      - 🇺🇸美国
      - 🎏其他

  - name: 🎬YouTube
    type: select
    proxies:
      - 🎬流媒体
      - ✈️起飞
      - 🇸🇬新加坡
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇯🇵日本
      - 🇺🇸美国

  - name: 🟢Spotify
    type: select
    proxies:
      - ✈️起飞
      - 🇺🇸美国
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇸🇬新加坡
      - 🇯🇵日本
      - DIRECT
      - 🎏其他

  # 社交和通讯
  - name: 📲社交媒体
    type: select
    proxies:
      - ✈️起飞
      - 🇸🇬新加坡
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇯🇵日本
      - 🇺🇸美国
      - 🎏其他
      - 👆🏻指定

  - name: 📱电报
    type: select
    proxies:
      - ✈️起飞
      - 🇸🇬新加坡
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇯🇵日本
      - 🇺🇸美国
      - 🎏其他
      - 👆🏻指定

  # 开发和AI服务
  - name: 🧰开发工具
    type: select
    proxies:
      - ✈️起飞
      - 🇺🇸美国
      - 🇸🇬新加坡
      - 🇹🇼台湾
      - 🇯🇵日本
      - 🇭🇰香港
      - 👆🏻指定
      - DIRECT

  - name: 🤖AI
    type: select
    proxies:
      - 🇺🇸美国
      - 🇹🇼台湾
      - 🇸🇬新加坡
      - 🇯🇵日本
      - ✈️起飞
      - 👆🏻指定

  # 游戏和大型平台服务
  - name: 🎮游戏平台
    type: select
    proxies:
      - ✈️起飞
      - DIRECT
      - 🇺🇸美国
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇸🇬新加坡
      - 🇯🇵日本
      - 🎏其他

  - name: 🛡️Google服务
    type: select
    proxies:
      - ✈️起飞
      - 🇸🇬新加坡
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇯🇵日本
      - 🇺🇸美国
      - 🎏其他
      - DIRECT

  - name: Ⓜ️微软服务
    type: select
    proxies:
      - DIRECT
      - ✈️起飞
      - 🇺🇸美国
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇸🇬新加坡
      - 🇯🇵日本

  - name: 🍎苹果服务
    type: select
    proxies:
      - DIRECT
      - ✈️起飞
      - 🇺🇸美国
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇸🇬新加坡
      - 🇯🇵日本

  # 其他服务分组
  - name: 📧邮件服务
    type: select
    proxies:
      - ✈️起飞
      - DIRECT
      - 🇺🇸美国
      - 🇸🇬新加坡
      - 🎏其他

  - name: 🔎搜索引擎
    type: select
    proxies:
      - ✈️起飞
      - 🇺🇸美国
      - 🇭🇰香港
      - 🇹🇼台湾
      - 🇸🇬新加坡
      - 🇯🇵日本
      - DIRECT

  - name: 🐟漏网之鱼
    type: select
    proxies:
      - ✈️起飞
      - 🛩️墙内
      - 💩广告
      - DIRECT
      - 👆🏻指定

  # 地区分组
  - name: 🇭🇰香港
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 300
    tolerance: 100
    filter: "(?i)港|hongkong|hk"

  - name: 🇹🇼台湾
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 300
    tolerance: 100
    filter: "(?i)台|taiwan|tw"

  - name: 🇸🇬新加坡
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 300
    tolerance: 100
    filter: "(?i)新|狮|獅|singapore|sg"

  - name: 🇯🇵日本
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 300
    tolerance: 100
    filter: "(?i)日|japan|jp"

  - name: 🇺🇸美国
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 300
    tolerance: 100
    filter: "(?i)美|states|us"

  - name: 🎏其他
    type: select
    filter: "^(?!.*(港|hongkong|hk|台|taiwan|tw|新|狮|獅|singapore|sg|日|japan|jp|美|states|us)).*$"

# ========== 分流规则配置 ==========
rules:
  # 本地网络和基础规则
  - RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/private.txt,DIRECT

  # 广告和隐私保护
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising.yaml,💩广告

  # 开发工具和AI服务
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Developer/Developer.yaml,🧰开发工具
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub.list,🧰开发工具
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/AI/AI.yaml,🤖AI

  # 即时通讯
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.list,📱电报
  - RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/telegramcidr.txt,📱电报

  # 国际平台服务
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.list,🛡️Google服务
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple.list,🍎苹果服务
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.list,Ⓜ️微软服务

  # 社交媒体平台
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter.list,📲社交媒体
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Instagram/Instagram.list,📲社交媒体
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Facebook/Facebook.list,📲社交媒体
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/TikTok/TikTok.list,📲社交媒体
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Reddit/Reddit.list,📲社交媒体
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Discord/Discord.list,📲社交媒体

  # 游戏平台
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/Game.list,🎮游戏平台

  # 流媒体服务
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GlobalMedia/GlobalMedia.list,🎬流媒体
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Netflix/Netflix.list,🎬Netflix
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.list,🎬YouTube
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.list,🟢Spotify
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/BiliBili/BiliBili.list,📺B站

  # 国内服务
  - RULE-SET,https://raw.githubusercontent.com/moistrr/Clashruleset/refs/heads/main/config/zhilian.list,🛩️墙内
  - RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaMax/ChinaMax.list,🛩️墙内

  # 国外集合规则
  - RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/proxy.txt,✈️起飞

  # 高效域名集
  - RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/direct.txt,🛩️墙内
  - RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/clash-rules/release/gfw.txt,✈️起飞

  # GeoIP规则
  - GEOIP,LAN,🛩️墙内,no-resolve
  - GEOIP,CN,🛩️墙内,no-resolve

  # 兜底规则
  - MATCH,🐟漏网之鱼
